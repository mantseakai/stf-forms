<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health & Safety Inspection - Step by Step</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.5;
        }
        
        .container {
            max-width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 20px 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .progress-container {
            background: white;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545, #c82333);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        
        .form-container {
            flex: 1;
            padding: 20px 15px;
            background: white;
            margin: 0;
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
        }
        
        .step-title {
            font-size: 1.3em;
            color: #dc3545;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .form-col {
            flex: 1;
            min-width: 250px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s ease;
            background: #fafafa;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #dc3545;
            outline: none;
            background: white;
        }
        
        .required {
            color: #dc3545;
        }
        
        .checkbox-group {
            margin-top: 15px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 12px;
            margin-top: 2px;
            flex-shrink: 0;
        }
        
        .checkbox-item label {
            margin: 0;
            font-weight: normal;
            font-size: 0.95em;
            line-height: 1.4;
        }
        
        .location-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .location-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-height: 48px;
        }
        
        .btn-primary {
            background: #dc3545;
            color: white;
        }
        
        .btn-primary:hover {
            background: #c82333;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .navigation {
            background: white;
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        
        .nav-btn {
            flex: 1;
            max-width: 150px;
        }
        
        .district-search input {
            margin-bottom: 8px;
            font-size: 14px;
            padding: 8px 12px;
        }
        
        .location-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .location-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .location-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .location-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .form-summary {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            font-weight: 600;
            color: #495057;
        }
        
        .summary-value {
            color: #6c757d;
            text-align: right;
            max-width: 60%;
            word-break: break-word;
        }
        
        .safety-section {
            background: #ffe6e6;
            border: 1px solid #ffcccc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .safety-section h5 {
            color: #dc3545;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        /* Action buttons for saved forms */
        .action-buttons {
            background: white;
            padding: 20px 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .action-buttons .btn {
            width: 100%;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            margin: 20px;
            border-radius: 8px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            border-radius: 8px 8px 0 0;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .saved-form-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .saved-form-title {
            font-weight: 600;
            color: #dc3545;
            margin-bottom: 8px;
        }
        
        .saved-form-details {
            font-size: 0.9em;
            color: #6c757d;
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .form-col {
                min-width: 100%;
            }
            
            .location-buttons {
                flex-direction: column;
            }
            
            .btn {
                padding: 12px 16px;
                font-size: 0.9em;
            }
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üèõÔ∏è MINISTRY OF LABOUR, JOBS AND EMPLOYMENT</h1>
            <p>Department of Factories Inspectorate - Health & Safety Inspection</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                Step <span id="currentStep">1</span> of <span id="totalSteps">10</span>
            </div>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <form id="safetyForm">
                <!-- Step 1: Company Information -->
                <div class="step active" data-step="1">
                    <div class="step-title">üè¢ Company Information</div>
                    
                    <!-- Location Section -->
                    <div class="location-section">
                        <h4>üìç Location Information</h4>
                        <div class="location-buttons">
                            <button type="button" class="btn btn-warning" onclick="getGPSLocation()">üì° Get GPS</button>
                            <button type="button" class="btn btn-info" onclick="openGoogleMaps()">üó∫Ô∏è Google Maps</button>
                        </div>
                        <div id="locationStatus" class="location-status location-warning">
                            üìç Choose a method to get location coordinates
                        </div>
                        <div class="form-group">
                            <label for="manualCoordinates">üìç Coordinates (Latitude, Longitude):</label>
                            <input type="text" id="manualCoordinates" name="manualCoordinates" placeholder="e.g., 5.6037, -0.1870" onchange="updateLocationDisplay()">
                        </div>
                        <div class="form-group">
                            <label for="locationDescription">üè¢ Landmark/Description:</label>
                            <input type="text" id="locationDescription" name="locationDescription" placeholder="e.g., Near Kotoka Airport, Behind Total Station">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="companyName">Company Name <span class="required">*</span></label>
                        <input type="text" id="companyName" name="companyName" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="companyTIN">Tax Identification Number <span class="required">*</span></label>
                                <input type="text" id="companyTIN" name="companyTIN" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="district">District <span class="required">*</span></label>
                                <div class="district-search">
                                    <input type="text" id="districtSearch" placeholder="Search for district..." onkeyup="filterDistricts()">
                                </div>
                                <select id="district" name="district" required>
                                    <option value="">-- Select District --</option>
                                    <option value="Accra Metropolitan">Accra Metropolitan</option>
                                    <option value="Kumasi Metropolitan">Kumasi Metropolitan</option>
                                    <option value="Tema Metropolitan">Tema Metropolitan</option>
                                    <option value="Sekondi Takoradi Metropolitan">Sekondi Takoradi Metropolitan</option>
                                    <option value="Tamale Metropolitan">Tamale Metropolitan</option>
                                    <option value="Cape Coast Metropolitan">Cape Coast Metropolitan</option>
                                    <option value="Ho Municipal">Ho Municipal</option>
                                    <option value="Sunyani Municipal">Sunyani Municipal</option>
                                    <option value="Wa Municipal">Wa Municipal</option>
                                    <option value="Bolgatanga Municipal">Bolgatanga Municipal</option>
                                    <!-- Add more districts as needed -->
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="contactPerson">Contact Person Name <span class="required">*</span></label>
                                <input type="text" id="contactPerson" name="contactPerson" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="contactRole">Contact Person Role <span class="required">*</span></label>
                                <input type="text" id="contactRole" name="contactRole" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="contactPhone">Contact Phone Number <span class="required">*</span></label>
                                <input type="tel" id="contactPhone" name="contactPhone" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="totalEmployees">Total Employees</label>
                                <input type="number" id="totalEmployees" name="totalEmployees" min="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Administrative Safety -->
                <div class="step" data-step="2">
                    <div class="step-title">üìã Administrative Safety</div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="firstAidKit" name="firstAidKit">
                            <label for="firstAidKit">üè• Is there a current first aid kit in a location known and accessible to all employees?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="healthSafetyTraining" name="healthSafetyTraining">
                            <label for="healthSafetyTraining">üéì Have employees received required health & safety trainings?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="safetyBulletinBoard" name="safetyBulletinBoard">
                            <label for="safetyBulletinBoard">üìå Is there a safety bulletin board displaying emergency phone numbers, evacuation routes and safety information?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="msdsAvailable" name="msdsAvailable">
                            <label for="msdsAvailable">üìÑ Are Material Safety Data Sheets (MSDSs) on file and available to employees?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="emergencyPlan" name="emergencyPlan">
                            <label for="emergencyPlan">üö® Does the emergency operations plan include evacuation routes and procedures?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="storeRoomManagement" name="storeRoomManagement">
                            <label for="storeRoomManagement">üì¶ Are all unused materials kept in the store room?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fireInspectionDocumented" name="fireInspectionDocumented">
                            <label for="fireInspectionDocumented">üî• Are fire inspections and fire drills documented?</label>
                        </div>
                    </div>
                </div>

                <!-- Step 3: General Safety/Housekeeping -->
                <div class="step" data-step="3">
                    <div class="step-title">üßπ General Safety & Housekeeping</div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="exitsClear" name="exitsClear">
                            <label for="exitsClear">üö™ Are exits, aisles, and corridors free of obstacles and combustible storage?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="furnitureSecured" name="furnitureSecured">
                            <label for="furnitureSecured">üóÑÔ∏è Are filing cabinets, bookcases and other tall items securely bolted to walls?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="materialsSecured" name="materialsSecured">
                            <label for="materialsSecured">üìö Are materials on shelves above chest level secured?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="stairwaysSecured" name="stairwaysSecured">
                            <label for="stairwaysSecured">ü™ú Are stairways secured and in good condition?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="heatingMachinesSecure" name="heatingMachinesSecure">
                            <label for="heatingMachinesSecure">‚òï Are heating machines (kettle, coffee maker, etc.) securely placed to avoid risk of burns?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="overheadStorageSafe" name="overheadStorageSafe">
                            <label for="overheadStorageSafe">üì¶ Is overhead storage of heavy items prevented from falling?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="stepLaddersProvided" name="stepLaddersProvided">
                            <label for="stepLaddersProvided">ü™ú Are stepladders provided for high storage areas?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="officeAreasCleaned" name="officeAreasCleaned">
                            <label for="officeAreasCleaned">üßΩ Are office areas cleaned & maintained regularly?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="wasteMaterialsProper" name="wasteMaterialsProper">
                            <label for="wasteMaterialsProper">üóëÔ∏è Are all waste materials placed in proper containers and emptied regularly?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="flooringGoodCondition" name="flooringGoodCondition">
                            <label for="flooringGoodCondition">üè† Is flooring in good condition with loose rugs and mats secured?</label>
                        </div>
                    </div>
                </div>

                <!-- Step 4: General Welfare -->
                <div class="step" data-step="4">
                    <div class="step-title">üåü General Welfare</div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="drinkingWaterProvided" name="drinkingWaterProvided">
                            <label for="drinkingWaterProvided">üíß Is wholesome drinking water provided and maintained at suitable points?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="waterStorageSuitable" name="waterStorageSuitable">
                            <label for="waterStorageSuitable">üè∫ Is water stored in a suitable container?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="waterRenewedDaily" name="waterRenewedDaily">
                            <label for="waterRenewedDaily">üîÑ Is the drinking water renewed daily?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="drinkingWaterMarked" name="drinkingWaterMarked">
                            <label for="drinkingWaterMarked">üè∑Ô∏è Is drinking water clearly marked 'Drinking Water'?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="clothingClosetProvided" name="clothingClosetProvided">
                            <label for="clothingClosetProvided">üëï Is a closet provided for storing workers clothing?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="clothingClosetMaintained" name="clothingClosetMaintained">
                            <label for="clothingClosetMaintained">üßπ Is the closet properly maintained?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="washingFacilitiesAvailable" name="washingFacilitiesAvailable">
                            <label for="washingFacilitiesAvailable">üßº Are washing facilities available for employees?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="employeesEatSafely" name="employeesEatSafely">
                            <label for="employeesEatSafely">üçΩÔ∏è Do employees have safe eating areas free from dust or fumes?</label>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Fire Protection -->
                <div class="step" data-step="5">
                    <div class="step-title">üî• Fire Protection</div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="exitsMarked" name="exitsMarked">
                            <label for="exitsMarked">üö™ Are exits visibly marked & clear of obstruction?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="emergencyDoorsClosed" name="emergencyDoorsClosed">
                            <label for="emergencyDoorsClosed">üîí Are emergency doors functioning properly at all times?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="stairwaysClear" name="stairwaysClear">
                            <label for="stairwaysClear">ü™ú Are stairways clear from obstacles?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fireExtinguishersAvailable" name="fireExtinguishersAvailable">
                            <label for="fireExtinguishersAvailable">üßØ Are proper fire extinguishers and smoke detectors available & inspected?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="disabilityProcedures" name="disabilityProcedures">
                            <label for="disabilityProcedures">‚ôø Are special procedures in place for workers with disabilities?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="combustibleMaterialsStored" name="combustibleMaterialsStored">
                            <label for="combustibleMaterialsStored">üì¶ Are combustible materials stored in designated storage areas?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fireDrillsRegular" name="fireDrillsRegular">
                            <label for="fireDrillsRegular">üö® Are fire drills held on a regular basis?</label>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Electrical Safety -->
                <div class="step" data-step="6">
                    <div class="step-title">‚ö° Electrical Safety</div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="electricalComponentsGood" name="electricalComponentsGood">
                            <label for="electricalComponentsGood">üîå Are all plugs, electrical cords, panels, and receptacles in good condition?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="extensionCordsWalls" name="extensionCordsWalls">
                            <label for="extensionCordsWalls">üß± Are extension cords running through walls?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="extensionCordsDoors" name="extensionCordsDoors">
                            <label for="extensionCordsDoors">üö™ Are extension cords running under or over doors?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="extensionCordsAisles" name="extensionCordsAisles">
                            <label for="extensionCordsAisles">üö∂ Are extension cords running across aisles?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="extensionCordsPermanent" name="extensionCordsPermanent">
                            <label for="extensionCordsPermanent">üîå Are extension cords used as permanent electrical supply?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="electricalPanelAccess" name="electricalPanelAccess">
                            <label for="electricalPanelAccess">üö™ Is clear access (36" clearance) provided to electrical panels?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="faultyEquipmentRemoved" name="faultyEquipmentRemoved">
                            <label for="faultyEquipmentRemoved">‚ùå Is faulty or broken equipment removed from service?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="lampsClearCombustibles" name="lampsClearCombustibles">
                            <label for="lampsClearCombustibles">üí° Are lamps well clear of curtains, papers and other combustible materials?</label>
                        </div>
                    </div>
                </div>

                <!-- Step 7: Computer Workstations -->
                <div class="step" data-step="7">
                    <div class="step-title">üíª Computer Workstations</div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="keyboardMouseReach" name="keyboardMouseReach">
                            <label for="keyboardMouseReach">‚å®Ô∏è Are the keyboard and mouse within easy reach?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="keyboardMonitorAligned" name="keyboardMonitorAligned">
                            <label for="keyboardMonitorAligned">üñ•Ô∏è Are keyboard and monitor properly aligned?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="chairsAdjustable" name="chairsAdjustable">
                            <label for="chairsAdjustable">ü™ë Are chairs used at computer workstations adjustable?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="legKneeClearance" name="legKneeClearance">
                            <label for="legKneeClearance">ü¶µ Is leg and knee clearance available under the desk surface?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="monitorDistance" name="monitorDistance">
                            <label for="monitorDistance">üëÅÔ∏è Are monitors positioned at appropriate viewing distance and height?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="lightingAdequate" name="lightingAdequate">
                            <label for="lightingAdequate">üí° Is lighting adequate and free from glare on computer screens?</label>
                        </div>
                    </div>
                </div>

                <!-- Step 8: Incident Management -->
                <div class="step" data-step="8">
                    <div class="step-title">üìä Incident Management</div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="accidentRecordsKept" name="accidentRecordsKept">
                            <label for="accidentRecordsKept">üìã Does the workplace keep records of every incident/accident?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="occupationalDiseaseRecords" name="occupationalDiseaseRecords">
                            <label for="occupationalDiseaseRecords">üè• Does the workplace keep records of every case of occupational disease?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="writtenNoticesSent" name="writtenNoticesSent">
                            <label for="writtenNoticesSent">üì§ Are written notices of incidents sent to the Chief Inspector of Factories?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="incidentInvestigation" name="incidentInvestigation">
                            <label for="incidentInvestigation">üîç Are incidents properly investigated to prevent recurrence?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="correctiveActions" name="correctiveActions">
                            <label for="correctiveActions">üîß Are corrective actions implemented after incidents?</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="incidentDetails">Details of any recent incidents (if applicable)</label>
                        <textarea id="incidentDetails" name="incidentDetails" rows="3" placeholder="Describe any recent safety incidents..."></textarea>
                    </div>
                </div>

                <!-- Step 9: Certificates/Permits -->
                <div class="step" data-step="9">
                    <div class="step-title">üìú Certificates/Permits Available</div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="labourCertificate" name="labourCertificate">
                            <label for="labourCertificate">üèõÔ∏è Labour Certificate (Department of Labour)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="factoriesCertificate" name="factoriesCertificate">
                            <label for="factoriesCertificate">üè≠ Factories, Offices & Shops Certificate (DFI)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="incorporationCertificate" name="incorporationCertificate">
                            <label for="incorporationCertificate">üìã Certificate of Incorporation (RGD)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="commenceCertificate" name="commenceCertificate">
                            <label for="commenceCertificate">üè¢ Certificate to Commence Business (RGD)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="environmentalPermit" name="environmentalPermit">
                            <label for="environmentalPermit">üåç Environmental Permit (EPA)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="safetyTraining" name="safetyTraining">
                            <label for="safetyTraining">üéì Health & Safety Training (Department of Labour)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fireCertificate" name="fireCertificate">
                            <label for="fireCertificate">üî• Fire Certificate (GNFS)</label>
                        </div>
                    </div>
                </div>

                <!-- Step 10: Inspector Information -->
                <div class="step" data-step="10">
                    <div class="step-title">üë§ Inspector Information</div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="inspectorID">Inspector ID <span class="required">*</span></label>
                                <input type="text" id="inspectorID" name="inspectorID" required placeholder="e.g., INS001, SAF-GH-001" style="text-transform: uppercase;">
                                <small style="color: #666; font-size: 0.8em;">Use your official inspector ID number</small>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="inspectorName">Name of Inspector <span class="required">*</span></label>
                                <input type="text" id="inspectorName" name="inspectorName" required placeholder="First Last" onblur="validateInspectorName()">
                                <div id="inspectorSuggestions" style="display: none; margin-top: 5px; padding: 8px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; font-size: 0.9em;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="inspectionDate">Inspection Date <span class="required">*</span></label>
                                <input type="date" id="inspectionDate" name="inspectionDate" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="supervisorSignature">Supervisor's Name</label>
                                <input type="text" id="supervisorSignature" name="supervisorSignature">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="overallSafetyRating">Overall Safety Rating</label>
                        <select id="overallSafetyRating" name="overallSafetyRating">
                            <option value="">Select rating</option>
                            <option value="excellent">Excellent - No major issues</option>
                            <option value="good">Good - Minor issues to address</option>
                            <option value="satisfactory">Satisfactory - Some improvements needed</option>
                            <option value="poor">Poor - Major safety concerns</option>
                            <option value="critical">Critical - Immediate action required</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="inspectorComments">Inspector Comments & Recommendations</label>
                        <textarea id="inspectorComments" name="inspectorComments" rows="4" placeholder="Describe safety violations found, recommendations for improvement, follow-up actions required..."></textarea>
                    </div>
                    
                    <!-- Form Summary -->
                    <div class="form-summary">
                        <h4>üîí Safety Inspection Summary</h4>
                        <div class="summary-item">
                            <span class="summary-label">Company:</span>
                            <span class="summary-value" id="summaryCompany">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">District:</span>
                            <span class="summary-value" id="summaryDistrict">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Contact:</span>
                            <span class="summary-value" id="summaryContact">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Total Employees:</span>
                            <span class="summary-value" id="summaryEmployees">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Safety Rating:</span>
                            <span class="summary-value" id="summaryRating">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Inspector:</span>
                            <span class="summary-value" id="summaryInspector">-</span>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button type="button" class="btn btn-danger nav-btn" onclick="cancelForm()">‚ùå Cancel</button>
            <button type="button" class="btn btn-secondary nav-btn" id="prevBtn" onclick="previousStep()" style="display: none;">‚Üê Previous</button>
            <button type="button" class="btn btn-primary nav-btn" id="nextBtn" onclick="nextStep()">Next ‚Üí</button>
            <button type="button" class="btn btn-success nav-btn" id="submitBtn" onclick="submitForm()" style="display: none;">üîí Save</button>
        </div>

        <!-- Action Buttons (shown after submission) -->
        <div class="action-buttons hidden" id="actionButtons">
            <button type="button" class="btn btn-success" onclick="exportToCSV()">üìä Export to CSV</button>
            <button type="button" class="btn btn-info" onclick="viewSavedForms()">üìÅ View Saved Forms</button>
            <button type="button" class="btn btn-warning" onclick="shareData()">üì± Share Data</button>
            <button type="button" class="btn btn-secondary" onclick="goHome()">üè† Home</button>
        </div>
    </div>

    <!-- Saved Forms Modal -->
    <div class="modal" id="savedFormsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîí Saved Safety Inspections</h3>
            </div>
            <div class="modal-body" id="savedFormsList">
                <!-- Saved forms will be populated here -->
            </div>
            <div style="padding: 20px; text-align: center;">
                <button type="button" class="btn btn-secondary" onclick="closeSavedFormsModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 10;
        let currentLocationData = {
            coordinates: null,
            method: null,
            description: null
        };

        // Initialize form
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            document.getElementById('inspectionDate').value = new Date().toISOString().split('T')[0];
            
            // Auto-save functionality
            const form = document.getElementById('safetyForm');
            form.addEventListener('input', debounce(autoSave, 2000));
        });

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('currentStep').textContent = currentStep;
            document.getElementById('totalSteps').textContent = totalSteps;
            
            // Update navigation buttons
            document.getElementById('prevBtn').style.display = currentStep > 1 ? 'block' : 'none';
            document.getElementById('nextBtn').style.display = currentStep < totalSteps ? 'block' : 'none';
            document.getElementById('submitBtn').style.display = currentStep === totalSteps ? 'block' : 'none';
            
            // Update summary if on last step
            if (currentStep === totalSteps) {
                updateSummary();
            }
        }

        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
                    currentStep++;
                    document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
                    updateProgress();
                    window.scrollTo(0, 0);
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
                currentStep--;
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
                updateProgress();
                window.scrollTo(0, 0);
            }
        }

        function validateCurrentStep() {
            const currentStepElement = document.querySelector(`.step[data-step="${currentStep}"]`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            
            for (let field of requiredFields) {
                if (!field.value.trim()) {
                    field.focus();
                    alert(`Please fill in the required field: ${field.previousElementSibling.textContent.replace('*', '').trim()}`);
                    return false;
                }
            }
            return true;
        }

        function updateSummary() {
            document.getElementById('summaryCompany').textContent = document.getElementById('companyName').value || '-';
            document.getElementById('summaryDistrict').textContent = document.getElementById('district').value || '-';
            document.getElementById('summaryContact').textContent = document.getElementById('contactPerson').value || '-';
            document.getElementById('summaryEmployees').textContent = document.getElementById('totalEmployees').value || '-';
            document.getElementById('summaryRating').textContent = document.getElementById('overallSafetyRating').value || '-';
            document.getElementById('summaryInspector').textContent = document.getElementById('inspectorName').value || '-';
        }

        // Inspector name validation and suggestions
        function validateInspectorName() {
            const inspectorName = document.getElementById('inspectorName').value.trim();
            const suggestionDiv = document.getElementById('inspectorSuggestions');
            
            if (inspectorName.length < 2) {
                suggestionDiv.style.display = 'none';
                return;
            }
            
            // Get known inspectors from localStorage
            const knownInspectors = getKnownInspectors();
            
            // Find similar names using fuzzy matching
            const suggestions = findSimilarNames(inspectorName, knownInspectors);
            
            if (suggestions.length > 0) {
                suggestionDiv.innerHTML = `
                    <strong>üí° Did you mean?</strong><br>
                    ${suggestions.map(name => `<a href="#" onclick="selectInspectorName('${name}')" style="color: #856404; text-decoration: underline; margin-right: 10px;">${name}</a>`).join('')}
                `;
                suggestionDiv.style.display = 'block';
            } else {
                // Add new inspector to known list
                addKnownInspector(inspectorName);
                suggestionDiv.style.display = 'none';
            }
        }
        
        function selectInspectorName(name) {
            document.getElementById('inspectorName').value = name;
            document.getElementById('inspectorSuggestions').style.display = 'none';
        }
        
        function getKnownInspectors() {
            return JSON.parse(localStorage.getItem('known_inspectors') || '[]');
        }
        
        function addKnownInspector(name) {
            const knownInspectors = getKnownInspectors();
            const normalizedName = normalizeName(name);
            
            if (!knownInspectors.some(inspector => normalizeName(inspector) === normalizedName)) {
                knownInspectors.push(name);
                localStorage.setItem('known_inspectors', JSON.stringify(knownInspectors));
            }
        }
        
        function normalizeName(name) {
            return name.toLowerCase().replace(/[^a-z\s]/g, '').replace(/\s+/g, ' ').trim();
        }
        
        function findSimilarNames(input, knownNames) {
            const normalizedInput = normalizeName(input);
            const suggestions = [];
            
            knownNames.forEach(name => {
                const normalizedName = normalizeName(name);
                const similarity = calculateSimilarity(normalizedInput, normalizedName);
                
                if (similarity > 0.6 && normalizedInput !== normalizedName) {
                    suggestions.push(name);
                }
            });
            
            return suggestions.slice(0, 3); // Return top 3 suggestions
        }
        
        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const distance = levenshteinDistance(longer, shorter);
            return (longer.length - distance) / longer.length;
        }
        
        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        function getFormData() {
            const formData = {};
            const form = document.getElementById('safetyForm');
            
            // Get all form elements
            const elements = form.querySelectorAll('input, select, textarea');
            elements.forEach(element => {
                if (element.type === 'checkbox') {
                    formData[element.name] = element.checked ? 'Yes' : 'No';
                } else {
                    formData[element.name] = element.value || '';
                }
            });
            
            // Add location data
            formData.gpsCoordinates = currentLocationData.coordinates || document.getElementById('manualCoordinates').value || '';
            formData.locationMethod = currentLocationData.method || (document.getElementById('manualCoordinates').value ? 'Manual' : '');
            
            // Add metadata
            formData.formType = 'Health & Safety Inspection';
            formData.submissionTime = new Date().toISOString();
            formData.formId = 'SAFETY_' + Date.now();
            
            return formData;
        }

        function submitForm() {
            if (!validateCurrentStep()) {
                return;
            }
            
            const formData = getFormData();
            
            // Get saved forms
            let savedForms = JSON.parse(localStorage.getItem('safety_inspections') || '[]');
            savedForms.push(formData);
            
            // Save to localStorage
            localStorage.setItem('safety_inspections', JSON.stringify(savedForms));
            
            // Clear auto-save
            localStorage.removeItem('safety_form_autosave');
            
            // Show success message and action buttons
            alert(`üîí Health & safety inspection saved successfully!\n\nCompany: ${formData.companyName}\nRating: ${formData.overallSafetyRating}\nTotal saved: ${savedForms.length} inspections`);
            
            // Hide form and show action buttons
            document.querySelector('.form-container').style.display = 'none';
            document.querySelector('.navigation').style.display = 'none';
            document.getElementById('actionButtons').classList.remove('hidden');
        }

        function autoSave() {
            const formData = getFormData();
            formData.autoSaved = true;
            formData.lastAutoSave = new Date().toISOString();
            localStorage.setItem('safety_form_autosave', JSON.stringify(formData));
        }

        function cancelForm() {
            if (confirm('Are you sure you want to cancel? All unsaved data will be lost.')) {
                localStorage.removeItem('safety_form_autosave');
                window.location.href = 'index.html'; // Return to home screen
            }
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        function startNewForm() {
            // Reset form
            document.getElementById('safetyForm').reset();
            document.getElementById('inspectionDate').value = new Date().toISOString().split('T')[0];
            
            // Reset step
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
            currentStep = 1;
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
            
            // Show form, hide action buttons
            document.querySelector('.form-container').style.display = 'block';
            document.querySelector('.navigation').style.display = 'flex';
            document.getElementById('actionButtons').classList.add('hidden');
            
            // Reset location data
            currentLocationData = { coordinates: null, method: null, description: null };
            updateLocationStatus('üìç Choose a method to get location coordinates', 'warning');
            
            updateProgress();
            window.scrollTo(0, 0);
        }

        function exportToCSV() {
            const savedForms = JSON.parse(localStorage.getItem('safety_inspections') || '[]');
            
            if (savedForms.length === 0) {
                alert('No saved forms to export.');
                return;
            }
            
            // Create CSV content
            const headers = Object.keys(savedForms[0]);
            let csvContent = headers.join(',') + '\n';
            
            savedForms.forEach(form => {
                const row = headers.map(header => {
                    const value = form[header] || '';
                    return '"' + String(value).replace(/"/g, '""') + '"';
                });
                csvContent += row.join(',') + '\n';
            });
            
            // Download CSV file with date tag
            const dateTag = new Date().toISOString().split('T')[0];
            const filename = `Safety_Inspections_${dateTag}.csv`;
            
            downloadCSVFile(csvContent, filename);
            
            alert(`üîí Exported ${savedForms.length} safety inspection records to ${filename}`);
        }
        
        function shareData() {
            const savedForms = JSON.parse(localStorage.getItem('safety_inspections') || '[]');
            
            if (savedForms.length === 0) {
                alert('No data to share. Please save some safety inspection forms first.');
                return;
            }
            
            // Create CSV content
            const headers = Object.keys(savedForms[0]);
            let csvContent = headers.join(',') + '\n';
            
            savedForms.forEach(form => {
                const row = headers.map(header => {
                    const value = form[header] || '';
                    return '"' + String(value).replace(/"/g, '""') + '"';
                });
                csvContent += row.join(',') + '\n';
            });
            
            const dateTag = new Date().toISOString().split('T')[0];
            const filename = `Safety_Inspections_${dateTag}.csv`;
            
            // Try Web Share API first (modern browsers)
            if (navigator.share && navigator.canShare) {
                shareViaWebAPI(csvContent, filename, 'Safety Inspections');
            } else {
                // Fallback to custom share modal
                showShareModal(csvContent, filename, 'Safety Inspections');
            }
        }
        
        function shareViaWebAPI(csvContent, filename, title) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const file = new File([blob], filename, { type: 'text/csv' });
            
            if (navigator.canShare({ files: [file] })) {
                navigator.share({
                    title: title,
                    text: `${title} data exported on ${new Date().toLocaleDateString()}`,
                    files: [file]
                }).catch(err => {
                    console.log('Error sharing:', err);
                    showShareModal(csvContent, filename, title);
                });
            } else {
                showShareModal(csvContent, filename, title);
            }
        }
        
        function showShareModal(csvContent, filename, title) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const summary = `${title} data exported on ${new Date().toLocaleDateString()}`;
            
            const modalHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; justify-content: center; align-items: center;" onclick="closeShareModal(this)">
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 400px; width: 90%; text-align: center;" onclick="event.stopPropagation()">
                        <h3 style="margin-bottom: 20px;">üì± Share Data</h3>
                        <p style="margin-bottom: 20px; color: #666;">${summary}</p>
                        
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <button class="btn btn-success" onclick="shareViaWhatsApp('${encodeURIComponent(summary)}', '${filename}')">
                                üì± Share via WhatsApp
                            </button>
                            <button class="btn btn-info" onclick="shareViaEmail('${encodeURIComponent(summary)}', '${filename}')">
                                üìß Share via Email
                            </button>
                            <button class="btn btn-primary" onclick="downloadFile('${url}', '${filename}')">
                                üì• Download File
                            </button>
                            <button class="btn btn-secondary" onclick="closeShareModal(this.closest('[onclick*=closeShareModal]'))">
                                ‚ùå Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Store the blob URL for download
            window.tempCSVUrl = url;
            window.tempCSVFilename = filename;
        }
        
        function shareViaWhatsApp(summary, filename) {
            const message = `${decodeURIComponent(summary)}\n\nFile: ${filename}\n\nSent from Labour Inspection Mobile App`;
            const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`;
            
            // Open WhatsApp
            window.open(whatsappUrl, '_blank');
            
            // Also download the file so user can manually attach it
            if (window.tempCSVUrl) {
                downloadFile(window.tempCSVUrl, window.tempCSVFilename);
            }
            
            alert('üì± WhatsApp opened with message.\nüìé CSV file downloaded - attach it to your WhatsApp message.');
        }
        
        function shareViaEmail(summary, filename) {
            const subject = 'Safety Inspection Data Export';
            const body = `${decodeURIComponent(summary)}\n\nPlease find the attached CSV file containing the safety inspection data.\n\nFile: ${filename}\n\nSent from Labour Inspection Mobile App`;
            const mailtoUrl = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Open email app
            window.open(mailtoUrl, '_blank');
            
            // Also download the file so user can manually attach it
            if (window.tempCSVUrl) {
                downloadFile(window.tempCSVUrl, window.tempCSVFilename);
            }
            
            alert('üìß Email app opened with message.\nüìé CSV file downloaded - attach it to your email.');
        }
        
        function downloadFile(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
        
        function closeShareModal(modal) {
            if (window.tempCSVUrl) {
                window.URL.revokeObjectURL(window.tempCSVUrl);
                delete window.tempCSVUrl;
                delete window.tempCSVFilename;
            }
            modal.remove();
        }
        
        function downloadCSVFile(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function viewSavedForms() {
            const savedForms = JSON.parse(localStorage.getItem('safety_inspections') || '[]');
            const modalBody = document.getElementById('savedFormsList');
            
            if (savedForms.length === 0) {
                modalBody.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No saved forms found.</p>';
            } else {
                modalBody.innerHTML = savedForms.map((form, index) => {
                    const date = new Date(form.submissionTime).toLocaleDateString();
                    const time = new Date(form.submissionTime).toLocaleTimeString();
                    const rating = form.overallSafetyRating || 'Not rated';
                    return `
                        <div class="saved-form-item">
                            <div class="saved-form-title">${form.companyName || 'Unnamed Company'}</div>
                            <div class="saved-form-details">
                                üìÖ ${date} ${time}<br>
                                üë§ Inspector: ${form.inspectorName || 'Unknown'}<br>
                                üìç District: ${form.district || 'Unknown'}<br>
                                üîí Safety Rating: ${rating}<br>
                                üè¢ Contact: ${form.contactPerson || 'No contact'}<br>
                                üë• Employees: ${form.totalEmployees || 'Not specified'}
                                ${form.gpsCoordinates ? '<br>üó∫Ô∏è GPS: ' + form.gpsCoordinates : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            document.getElementById('savedFormsModal').style.display = 'block';
        }

        function closeSavedFormsModal() {
            document.getElementById('savedFormsModal').style.display = 'none';
        }

        // Location functions
        function getGPSLocation() {
            if ("geolocation" in navigator) {
                updateLocationStatus('üîç Getting GPS location...', 'warning');
                
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude.toFixed(6);
                        const lon = position.coords.longitude.toFixed(6);
                        currentLocationData.coordinates = `${lat}, ${lon}`;
                        currentLocationData.method = 'GPS';
                        document.getElementById('manualCoordinates').value = `${lat}, ${lon}`;
                        updateLocationStatus(`‚úÖ GPS coordinates: ${lat}, ${lon}`, 'success');
                    },
                    function(error) {
                        updateLocationStatus('‚ùå GPS failed. Use manual entry.', 'error');
                        alert('GPS failed. Please enter coordinates manually or use Google Maps.');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            } else {
                alert('GPS not supported. Please enter coordinates manually.');
            }
        }

        function openGoogleMaps() {
            alert('1. Open Google Maps\n2. Find the company location\n3. Long press on the location\n4. Copy the coordinates\n5. Paste them in the coordinates field');
            window.open('https://maps.google.com', '_blank');
        }

        function updateLocationDisplay() {
            const coords = document.getElementById('manualCoordinates').value;
            if (coords && coords.includes(',')) {
                currentLocationData.coordinates = coords.trim();
                currentLocationData.method = 'Manual';
                updateLocationStatus(`‚úÖ Coordinates entered: ${coords.trim()}`, 'success');
            }
        }

        function updateLocationStatus(message, type) {
            const statusDiv = document.getElementById('locationStatus');
            statusDiv.textContent = message;
            statusDiv.className = `location-status location-${type}`;
        }

        function filterDistricts() {
            const searchTerm = document.getElementById('districtSearch').value.toLowerCase();
            const select = document.getElementById('district');
            const options = select.options;
            
            for (let i = 1; i < options.length; i++) {
                const option = options[i];
                const text = option.text.toLowerCase();
                if (text.includes(searchTerm)) {
                    option.style.display = '';
                } else {
                    option.style.display = 'none';
                }
            }
        }

        // Utility functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('savedFormsModal');
            if (event.target === modal) {
                closeSavedFormsModal();
            }
        }
    </script>
</body>
</html>